name: CI Pipeline

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    name: ValidaÃ§Ã£o do CÃ³digo
    runs-on: ubuntu-latest
    
    steps:
      # ########################################
      # Recuperar o cÃ³digo
      # ########################################
      - name: ğŸ“¥ Recuperar cÃ³digo do repositÃ³rio
        uses: actions/checkout@v4
      
      # ########################################
      # ETAPA 2: Rodar go lint
      # ########################################
      - name: ğŸ”§ Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.25'
          cache: true
      
      - name: ğŸ” Executar go lint
        run: |
          go install golang.org/x/lint/golint@latest
          golint -set_exit_status ./...
      
      # ########################################
      # ETAPA 3: Verificar se existe SentimentAnalyzer.go
      # ########################################
      - name: âœ… Verificar arquivo SentimentAnalyzer.go
        run: |
          if [ ! -f "SentimentAnalyzer.go" ]; then
            echo "âŒ ERRO: Arquivo SentimentAnalyzer.go nÃ£o encontrado!"
            exit 1
          fi
          echo "âœ… Arquivo SentimentAnalyzer.go encontrado"
      
      # ########################################
      # ETAPA 4: Verificar se existe arquivo .go na pasta test
      # ########################################
      - name: ğŸ§ª Verificar arquivos .go na pasta test
        run: |
          if [ ! -d "tests" ]; then
            echo "âŒ ERRO: Pasta 'test' nÃ£o existe!"
            exit 1
          fi
          
          if ! ls tests/*.go 1> /dev/null 2>&1; then
            echo "âŒ ERRO: Nenhum arquivo .go encontrado na pasta test!"
            exit 1
          fi
          
          echo "âœ… Arquivos .go encontrados na pasta test:"
          ls -la tests/*.go
      
      # Mensagem de sucesso
      - name: ğŸ‰ Todas as verificaÃ§Ãµes passaram
        run: echo "âœ… Pipeline concluÃ­do com sucesso!"